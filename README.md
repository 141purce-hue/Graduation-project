# 🌿 番茄病虫害智能识别系统

一个基于深度学习和 PyQt5 的番茄病虫害智能识别系统，支持 **ONNX** 和 **PyTorch** 两种模型格式，提供图片和视频两种识别模式。

## ✨ 功能特点

- 🎨 **精美的图形界面**：采用现代化设计，颜色分区清晰，布局合理
- 📷 **图片识别**：支持 JPG、PNG、BMP 等常见图片格式
- 🎥 **视频识别**：支持 MP4、AVI、MOV、MKV 等视频格式的实时识别
- 🔍 **四类病害识别**：
  - ✅ Healthy Leaf (健康叶片)
  - 🟠 Leaf Mold (叶霉病)
  - 🔴 Septoria leaf spot (斑点病)
  - 🟣 Tomato leaf bacterial spot (细菌性斑点病)
- 📊 **实时结果显示**：显示识别结果和置信度
- ⏯️ **视频控制**：支持视频识别的开始和停止
- 🚀 **ONNX 支持**：支持 ONNX 格式模型，推理速度更快，依赖更少

## 📋 系统要求

### 核心依赖（必需）
- Python 3.8+
- PyQt5
- OpenCV (cv2)
- NumPy

### 模型推理引擎（至少选择一个）
- **ONNX Runtime**（推荐）：轻量级，速度快
- **Ultralytics + PyTorch**：功能完整，支持 .pt 格式

## 🚀 快速开始

### 方法1：一键安装（推荐）

**Windows 用户**：
```bash
# 双击运行安装脚本
install.bat
```

**Linux/Mac 用户**：
```bash
# 安装核心依赖
pip install PyQt5 opencv-python numpy

# 安装 ONNX Runtime（推荐）
pip install onnxruntime
```

### 方法2：使用 requirements.txt

```bash
pip install -r requirements.txt
```

### 准备模型文件

将训练好的模型文件放在程序目录下：

- **ONNX 格式**（推荐）：`best.onnx`
- **PyTorch 格式**：`best.pt`

如果你有 PyTorch 模型，可以转换为 ONNX：

```python
from ultralytics import YOLO
model = YOLO('best.pt')
model.export(format='onnx', imgsz=640)
```

## 📖 使用说明

1. **启动程序**：

```bash
python disease_detection_ui.py
```

2. **图片识别模式**：
   - 选择"📷 图片识别"单选按钮
   - 点击"📁 选择文件"按钮，选择要识别的图片
   - 点击"🔍 开始识别"按钮
   - 查看识别结果和标注图片

3. **视频识别模式**：
   - 选择"🎥 视频识别"单选按钮
   - 点击"📁 选择文件"按钮，选择要识别的视频
   - 点击"🔍 开始识别"按钮
   - 实时查看识别结果
   - 点击"⏹ 停止识别"可随时停止

## 🎨 界面说明

### 左侧控制面板
- **识别模式选择**：图片识别 / 视频识别
- **文件选择按钮**：选择要识别的文件
- **开始识别按钮**：启动识别过程
- **停止识别按钮**：停止视频识别（仅视频模式）
- **进度条**：显示识别进度
- **识别类别说明**：显示四种病害类型
- **状态信息**：显示当前系统状态

### 右侧显示区域
- **图像显示区**：显示原图、识别结果或视频帧
- **识别结果区**：显示详细的识别结果和置信度

## 🎯 识别类别

| 类别 | 颜色 | 说明 |
|------|------|------|
| Healthy Leaf | 🟢 绿色 | 健康叶片 |
| Leaf Mold | 🟠 橙色 | 叶霉病 |
| Septoria leaf spot | 🔴 红色 | 斑点病 |
| Tomato leaf bacterial spot | 🟣 紫色 | 细菌性斑点病 |

## ⚙️ 配置说明

可以在代码中修改以下参数：

```python
# 置信度阈值（第 417、460 行）
conf=0.5  # 可调整为 0.1-0.9 之间的值

# 窗口大小（第 66 行）
self.setGeometry(100, 100, 1400, 900)  # (x, y, width, height)
```

## 🔧 故障排除

1. **模型加载失败**：
   - 检查模型文件路径是否正确
   - 确认模型文件格式为 `.pt`

2. **视频无法播放**：
   - 确认视频编码格式是否支持
   - 尝试使用 MP4 格式的视频

3. **界面显示异常**：
   - 确认 PyQt5 安装正确
   - 检查系统字体是否支持中文

## 📝 注意事项

- 首次运行需要加载模型，可能需要几秒钟
- 视频识别会占用较多系统资源，建议使用性能较好的电脑
- 识别准确度取决于训练模型的质量
- 建议使用清晰度较高的图片或视频以获得更好的识别效果

## 📄 许可证

本项目仅供学习和研究使用。

## 👨‍💻 作者

毕业设计项目 - 番茄病虫害识别系统

